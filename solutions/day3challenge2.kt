/**
 * Rial Johnson
 * AOC Day 3 - Challenge 2
 */

fun main() {
    
    val input = "....##..#........##...#.#..#.##\r\n.#.#..#....##....#...#..##.....\r\n##.#..##..#...#..........##.#..\r\n.#.##.####..#......###.........\r\n#.#.#...........#.....#...#....\r\n#.......#....#.#.##..###..##..#\r\n.#...#...##....#.........#.....\r\n..........##.#.#.....#....#.#..\r\n.......##..##...#.#.#...#......\r\n.#.#.#...#...##...#.##.##..#...\r\n........##.#.#.###.........##..\r\n#.#..#.#.#.....#...#...#......#\r\n.#.#.#...##......#...#.........\r\n.#..##.##.#...#...##....#.#....\r\n.##...#..#..#......##.###....##\r\n.....#...#.###.....#.#.........\r\n#.##..#....#.#.#.#.............\r\n........#...#......#...#..#....\r\n##..##...##.##...#...#.###...##\r\n#.#....##.#...###......#..#.#..\r\n..#.....#.##......#..........#.\r\n#.......#..#......#.....#....#.\r\n.....###...........#....#.##...\r\n#.#........##.......#.#...#.##.\r\n.#.#.#........#........#.#.....\r\n#..#..##.....#.###..#.#.#.##..#\r\n..#.#...#..##.#.#.#.......###..\r\n........#........#..#..#...#...\r\n##............#...#..##.##...#.\r\n#....#.#.....##...#............\r\n............#...#..#.#.#....#..\r\n#.#.#...##.##.#....#....#......\r\n................###.....#.....#\r\n##.#####.#..#...###..#...###...\r\n...#.....#...#.#....#...#..#...\r\n.......#....##.##.#.##.........\r\n..#..#..##.....#...#.#.....#...\r\n...#...#.#.##.#..###.......#...\r\n...#...........#.#####..##..#..\r\n#.#...#........####..#......#.#\r\n#..#.##...........#.#......#.##\r\n#.#..#....##..#..##.#..........\r\n.....#..#.....#........##..#...\r\n...###.......#.##.......#......\r\n...##..#..#...#....#.###...#...\r\n....####....#........#.##.#.#.#\r\n#....#.....#.###.##...##..##.##\r\n.##.#...#.##.#......#..##.#....\r\n...#.............#.............\r\n..##..##.#.....#........##....#\r\n#.....#....#.......####...#..#.\r\n..#...#..#...#...##.#....##....\r\n.#...##....#....#..#....#......\r\n##..#.#...##......#..#.......##\r\n..#...#.##..#.....#.#...#..#.#.\r\n#..##....#..........#..........\r\n.#........#..#......#......#.#.\r\n...##.#.........#.#....#.#...#.\r\n#.....#.#..#...#...#..#...#...#\r\n#.........#.#.........##.......\r\n.#.......#......#.........###..\r\n.#..#..##...........#.....#..#.\r\n.#....................#.....#..\r\n.##.....#....#....#.###.....#..\r\n...##.#.....#.#....#.........#.\r\n.........##.....#.....#.##..#..\r\n......#......#.#..#..###...#..#\r\n..##...#.#..#...#.#....#.......\r\n..#..##.###.#..#..#..#......#..\r\n.....##...##.........#...##...#\r\n###.#..##....##...##.#..###....\r\n#...#.#..##......##...#.#..#...\r\n..........#....###....#........\r\n#.#.#.#.#.....#..##.##.....#...\r\n.##.....#...#.....#......#.....\r\n.#..........#.#.............#..\r\n.#..##..#.#..##...#....#.##...#\r\n..#.#..........#...#..........#\r\n.#.......#.......#...#..#.....#\r\n##.#...##...#......#.#..#......\r\n#####..#....#..#...#...#.#.....\r\n....#.......#.#..#.............\r\n#..#..#.#.####...#....#....##..\r\n#..#.##.#......#...#......#....\r\n#...##.##...#....#..........##.\r\n..#..#.......##.#....#...#.#...\r\n.....#.##..............##.....#\r\n..##.##...##.....#.........#.#.\r\n.#....##...##...##..#....##..#.\r\n.#...#....#..#......#.#........\r\n#....#.#.#..............#....##\r\n..##..#..#....#####.#....#.#.##\r\n#....#...#.##..#.##.........###\r\n#..#..#....#...............#.#.\r\n#....##...##........##.##.#.##.\r\n......#......##....##.....#.###\r\n#...##..#..#.....#.#........##.\r\n..#.#.##...#...#....#..###...#.\r\n#..##..#.###..##.#.#....#......\r\n..###..#.##........###.....#...\r\n#.............#.............#..\r\n.#.##....#..##.#...#....#.#####\r\n###.....###.#......##..#..##...\r\n.#.#......##.#....#....#.#..#..\r\n###..#..#....#......###.##.....\r\n......#.......#......#..##..##.\r\n..#..#...#..#....#.##....#.#..#\r\n.......##..#........#.#.##.....\r\n.#...#..#........#..#.#..#..#.#\r\n.#..#.##.......#......#...#.#..\r\n.##..##......##.#...#......####\r\n.....#....#......#.....#......#\r\n..........#.#.#...##.#..#.#....\r\n...#.......##......#..#.#.##...\r\n.###..#.#.#....................\r\n##...#...#.##............#.....\r\n....#....#.##...#..#.#...##....\r\n..#.#....#.###...#...#.#.####.#\r\n..#..#.#...#.#......##.........\r\n#..#..####.##.#.#..###....#...#\r\n....#..........#.##.#..#.#.#.#.\r\n#.#.##.........#.....##...#..##\r\n#......#...#.##.#......#..#.#..\r\n#...#........#..#..#...##...#..\r\n.....#.####..##..#.#.##..#...#.\r\n#..#........#........#...#....#\r\n...........#..#.....#.#.#.#....\r\n....#......#....#...#....##....\r\n.#.#..#...#.#....#..#.#....##.#\r\n....#...#...#.##..#...#..##...#\r\n#######...............##.....##\r\n.#.#..............#....#..#.###\r\n#......#.#......###....###.....\r\n##..#...#.##..##..##.#....#....\r\n#....##..#..#...#.#.#...#......\r\n..........#..#.##..##.##.#..##.\r\n....#.#.#.....##........#..#...\r\n..###...#.....##.##.....##..##.\r\n....#.#..#.#.......#.......#...\r\n..##.#..#.....##...###...#...#.\r\n..#.........#...##...#...#..#..\r\n..#..#..#..#..##.#...##..#.#...\r\n...##..#..##..#..####...#.....#\r\n............#............###...\r\n.#.#.###.#.....#.#.#..#.###..#.\r\n...#.........#.....####........\r\n....##.#..##.#.............#...\r\n....#.##.....#..#.....#......##\r\n..........#.............#...##.\r\n#..#.....#.......##..###.......\r\n..##.#...........#.......#..#..\r\n...#...#.#.##.###....#.#..#....\r\n...#..........##..#..#..#...###\r\n.........#.....#..##.....#..#..\r\n#........#...#...#..#.#....##..\r\n.#.#.....####..#.##.#..........\r\n###.......##..#.##...#.....#...\r\n..###.##.#..#..#..#.....##...#.\r\n.........#.....##.#..#..##.....\r\n#..#..##...###..............#..\r\n#....#.#....#..#.....#..####...\r\n####..#.....##...#..#.#.#.#...#\r\n...#....#.....#.##.#.#.#....##.\r\n..........#...#.....###....#.##\r\n#....#.#.#....#..#..#.....#....\r\n.....#.#...#......#....#......#\r\n.####....##...#...#......##..#.\r\n.#...#..#....#..#..............\r\n##.#...##...#.##..#......#.....\r\n..####.##..#....#.#......#.#.##\r\n........#.....##...#.#..##....#\r\n....#.#.#.#.###...#.#...##...##\r\n#.....#...####.#....#.#........\r\n..#.....#...##.........###.....\r\n....#....#....#..#......#####.#\r\n###.....#..#.#.#......#.##.#...\r\n....#.##......#..#.#...........\r\n.#....#....#.#..#.......#...##.\r\n...................#.#.#..#....\r\n##...#.....#........#....#...#.\r\n........##......#...##.#..#.#.#\r\n#.#..###...#....#.#...#.......#\r\n#..........##......#..#..#.....\r\n.............#...##.#...#......\r\n#..#....##..#.........#..#.###.\r\n.....#..........#....##.#...##.\r\n###....................#.#.##..\r\n#........##...##......#....###.\r\n#....#.............#....#...#..\r\n##.......##.#.......#....#..#..\r\n##...#............#..#.#....##.\r\n..#.#..#...#####..........#....\r\n..#.........##.....#.#...####..\r\n....#..............#...........\r\n..#...#.#.#..#.......##.#.#.#..\r\n....#.##.....##..#.....#..####.\r\n#...#...#...#.......#.........#\r\n......#..#.####...###.#.#.....#\r\n.......#..#..#.....#.#..##.#..#\r\n.#......##..#............#.....\r\n.#........#.#....#....#........\r\n.....#.#..#.##.#..##....#..#...\r\n#.#...........#....##.....#....\r\n..#..#..##.###..##..#..###.#.##\r\n##.#..#...##.#.........#...#.#.\r\n......#..#..##...#....#...#.##.\r\n#.##.......................#...\r\n.......#..#..#.##..##......#...\r\n..#.#...#.....#..###....#...#..\r\n##..#.....#..#..#.##.....#...##\r\n#...##...###...#.#..###....#...\r\n...#.#.#..####.....#...##....#.\r\n.#.#..##.....#..#.....##..##..#\r\n#...#..........#.##.#.#........\r\n..##....#.##....#..##......#...\r\n....#..........###.....####..##\r\n...........###....##.#.#.#.#...\r\n...#......................####.\r\n#.#.#...#.#.#.#.#......#.....##\r\n..###...#.####...#..##..#....#.\r\n....#....#.......#...#.........\r\n.#.###.............##..#...#...\r\n....#.#....##...#.....#.##.....\r\n#.......##.....#.#.....#....##.\r\n....##.....###..#.#..#....#...#\r\n......#..##...#......#.....#.##\r\n.#.....#.##.###....#.....#..###\r\n...#..#.###.#....#..#..#...##.#\r\n...##..#...#..#.#.#..#...#.....\r\n##.####...##..#.#.#....#.......\r\n..##..#.#.......##.#......##.#.\r\n....##....#....#..#....#..##.#.\r\n..##..........##....#...#.#..#.\r\n#.#...#.#.###.#.#..##.#...#....\r\n.....#..#.............#...#...#\r\n....#.#..#...##...#....#.##....\r\n#..#...#.###.....#...#.....#.#.\r\n#####....#....#....#.......#.##\r\n#...##....##.#.#...#.....##.#..\r\n#.......#...#..#..#...#....#...\r\n....#......#.#..........#....##\r\n#.###...#.#..##..#.##........#.\r\n#..#.....##.......#..#..#.#....\r\n...#...#.##...#....#.#.#.#...#.\r\n...##..#.#....#......###......#\r\n#.#....#...#..#..#....#........\r\n..#..#.#...##..........#.###...\r\n#..........#...#..#....#....###\r\n..#..#.#....#..............#...\r\n...#........#...#.#....###.#..#\r\n....#.#.#................#..#.#\r\n..#........##.#....#.#..#......\r\n...##..#..#.......#..#......#.#\r\n..#..#....#.........#....#.##..\r\n#.....#....###.#..#..#...#...#.\r\n..#..##.###.#..##....#.###.....\r\n...#...####..#........###.#....\r\n.........#.#...#..#..#.#.......\r\n.##.........##.#..............#\r\n..#.#.#.....###........#.#.#..#\r\n....##..#....#....#.#..#.......\r\n#.#.....#...#........##........\r\n.##.#.#..#..#.#.#.........#....\r\n#.....#..#.##...#...#..........\r\n##..#....#....##.#..#.........#\r\n................#.##.#......#.#\r\n..#..#.#........##...###..#...#\r\n##........#.......#...##.##..#.\r\n##....#.....#..##....#.......#.\r\n#.#....#.#........#..#.........\r\n......##......#...#.....#.##...\r\n###....#..........##.#.#......#\r\n......#...###.........###..#...\r\n.####....#...##..#.#.....#...#.\r\n.##...#...###....#...#.#..###..\r\n#..#......##...#.###..###...#..\r\n#....#.#.#..#....##...#.##..#..\r\n..#.....#...#..........#.##.###\r\n#.....#....###.......##..##.#..\r\n#..##...#..#....#.###......#...\r\n#..#........##..#.....#.#.#....\r\n#.##.#.#..#....#.#.............\r\n.#...............#....##.......\r\n.#.##......##........#...#..#.#\r\n.#...#....#....#...#..#...##...\r\n.....#..###...##........#.#....\r\n...#.......#....##..#..#....#..\r\n...###....#........#..#.###.#..\r\n......##..##..............###.#\r\n.......#.####..##....#.#....#..\r\n#...#......#...#..#.....##....#\r\n.#..#..###....#..##.##.#.......\r\n#......##......#..##....#..##..\r\n.....#..#.#......##.##..##.....\r\n...#..#.......#......#.........\r\n....#..####......#..#....#...#.\r\n..#.#..#...#....#....#.......#.\r\n####..#........#.###...##.#.#.#\r\n.......##........#.#.#...##....\r\n...#.........#..#.#..##....#...\r\n.....#..#...#.#....#...#.#.##.#\r\n#..##.....#.....##.......#...#.\r\n.......##.#.#.....#....#......#\r\n...#...#.##...#......#....#....\r\n..#..#.#...#..#.....#...###.#..\r\n.........#...#..#.......##.....\r\n..##...................#..#.###\r\n.##.##..#.#...#.#....#.....##..\r\n#.#...##...#...#...##..#......#\r\n....#..#...#.....##.#.....#..##\r\n##.#..........###..#...#..#....\r\n...##....#.##....#......#......\r\n.....#.........#....#.#.......#\r\n.......#............#.#.....#..\r\n..#..#...#..#####..#....##.....\r\n...##......##...#.#........##..\r\n.....#..###...##.#.#.##.#...#..\r\n..#.#.#..##..#.##...##.#.#.....\r\n......##...#..##......#.#......\r\n......................#........\r\n#...#..#....#..#.#.##.#.....#.#\r\n.#......#.#....#.#.#..#....#...\r\n.#..#.#.#..#....#.............."    
    val skiMapAsList = input.split("\r\n").toList()
    
    println(countTreesFromManySlopes(skiMapAsList))
}

fun countTreesFromManySlopes(skiMap: List<String>): Long {
    var count: Long = 1 // this val will likely be too large for an Int
    
    val slopes = listOf(Pair(1,1), Pair(3,1), Pair(5,1), Pair(7,1), Pair(1,2))
    
    slopes.forEach {
        count *= countTrees(skiMap, it.first, it.second)
    }
    
    return count
}

fun countTrees(skiMap: List<String>, xOffset: Int, yOffset: Int): Int {
    var count = 0
    var xPos = 0
    var yPos = 0
    
    skiMap.forEach {
        if (xPos < it.length - xOffset) xPos += xOffset else xPos = xPos + xOffset - it.length // wrap around if we've reached the edge of the map
        if (yPos < skiMap.size - yOffset) yPos += yOffset else return count
        if (skiMap[yPos][xPos] == '#') count++
    }

    return -1.also { "you've met with a terrible fate" }
}